# 实时通讯


### Web实时通讯简述

```
当前，web实时通讯方式有一下几种：commet(ajax longpull)，eventsource，websocket
commet和eventsource都是在原有的http协议上做的封装，受原有协议，软件的约束
websocket是为web实时通讯开发的新协议，支持全双工通讯，实时性更好
```


### 设计目的

最初，为了解决`singlecloud`中的异步时间推送和读取信息，准备使用websocket来解决。
检查后发现，还有一些问题，实时日志系统显示也需要websoket，实时交互如：命令行交互，
或者将来的在线实时编辑，消息发送，可能都需要websoket来承载。为了解决这些问题，所以
打算对当前的websoket通讯做一个规划。


### 设计主体

#### 数据通道划分

参照websocket通讯，考虑可以使用几种方式来接受后端的消息

##### 1. 应用级别划分

在应用上划分不通的消息通道，来处理各模块的数据。

优势：只需要一个websoket连接，就可以处理所有的数据，资源占用小，易于管理和权限控制

存在问题：需要设计好数据格式，并且划分数据通道，还需要基于事件来定义handler来处理数据。
应用开发要求很高，必须设计清楚才可以进行，避免设计不足导致全盘需要求改的情况。一般都需要
有一个成熟的框架来完成

##### 2. 协议上划分

每一个模块单独打开一个websoket连接，处理自己的数据。

优势：应用设计简单

存在问题：连接多时资源占用高，管理困难

#### 通讯数据划分分类

- 通知，消息
  * 日志推送
  * 告警推送
  * singlecloud事件
  * 集群事件
    * 节点事件
    * namespace事件

- 交互操作
  * Shell
  * 实时验证
  * 实时通讯

#### 前端实现

为了配置实时通讯，前端需要实现以下功能：

- 服务器事件监听
- 本地状态管理
- 视图状态同步

#### 后端实现

- 连接管理
- 事件监听/推送
